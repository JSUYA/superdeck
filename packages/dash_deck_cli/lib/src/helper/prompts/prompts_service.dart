import 'package:dash_deck_cli/src/helper/palm_service.dart';
import 'package:dash_deck_cli/src/helper/prompts/dto/prompt_data.dto.dart';
import 'package:palm_api/palm_api.dart';

class PromptsService {
  PromptsService._();

  static Future<String> createOutline(
    String topic,
  ) async {
    final prompt = TextPrompt(
      text:
          "Prompt Context:\n\nYou are a leading curriculum designer, celebrated for creating logical and comprehensive slide presentation outlines. Your aim is to craft slide titles that flow seamlessly, ensuring each:\n\n- Relevance: Directly pertains to the topic in question.\n- Progression: Forms a cohesive structure throughout the presentation.\n- Detailing: Provides potential sub-topics or bullet points in Markdown format for added context.\n- Furthermore, enhance the aesthetics and layout of the slide by embedding meta-information:\n\nBackground Imagery: \nIntegrate a contextual background image by leveraging broader, thematic keywords that can yield relevant and appealing results from platforms like Unsplash. Use the format:\n{background: https://source.unsplash.com/random/900×700/?KEYWORD}\nReplace KEYWORD with a broad yet relevant term that captures the essence of the slide's content. Keywords such as \"motivation\", \"code\", \"fitness\", \"challenge\", etc., are more likely to provide generic but thematic visuals than very specific terms.\n\nLayout Configurations:\nWhile it's important to set a slide's layout to complement its content, choose a layout configuration only when it enhances the message. Available options include:\n\ncontentLeft: Positions markdown text to the left, with the background image to the right.\ncontentRight: Displays markdown text to the right, and the background image to the left.\ncover: Superimposes markdown content directly over the background image.\n\nYour goal is to ensure that each slide is optimized for teaching and audience engagement. Proper use of Markdown syntax and heading hierarchy is essential.\ninput: 5k for beginners\noutput: [\n  {\n    \"content\": \"# Embarking on the Couch to 5k Journey\",\n    \"options\": {\n      \"layout\": \"cover\",\n      \"background\": \"https://source.unsplash.com/random/900×700?runner\"\n    }\n  },\n  {\n    \"content\": \"## The Vision\\n- Understanding the 5k goal\\n- The benefits of running\\n- Transforming from sedentary to active\",\n    \"options\": {\n      \"layout\": \"contentLeft\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?jogging\"\n    }\n  },\n  {\n    \"content\": \"## Debunking Myths\\n- 'I'm not a runner'\\n- '5k is too much for beginners'\\n- 'I don't have the time'\",\n    \"options\": {\n      \"layout\": \"contentRight\", \n      \"background\": \"https://source.unsplash.com/random/900×700/?procrastinate\"\n    }\n  },\n  {\n    \"content\": \"## 'Every journey begins with a single step.' \\nLao Tzu\",\n    \"options\": {\n      \"layout\": \"cover\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?journey\"\n    }\n  },\n  {\n    \"content\": \"## First Steps\\n- Starting with walking\\n- Introduce short run intervals\\n- Gradual progression\",\n    \"options\": {\n      \"layout\": \"contentLeft\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?runner,beginner\"\n    }\n  },\n  {\n    \"content\": \"## Tracking Progress\\n- Importance of recording milestones\\n- Using apps and wearable tech\\n- Celebrating small victories\",\n    \"options\": {\n      \"layout\": \"contentRight\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?exercise,journal\"\n    }\n  },\n  {\n    \"content\": \"## Overcoming Challenges\\n- Mental barriers\\n- Physical obstacles\\n- Consistency is key\",\n    \"options\": {\n      \"layout\": \"contentLeft\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?obstacle,runner\"\n    }\n  },\n  {\n    \"content\": \"## 'The finish line is just the beginning of a whole new race.'\",\n    \"options\": {\n      \"layout\": \"cover\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?finish,runner\"\n    }\n  },\n  {\n    \"content\": \"## Preparing for Race Day\\n- Picking the right event\\n- What to expect\\n- Strategies to complete your first 5k\",\n    \"options\": {\n      \"layout\": \"contentRight\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?runner,race\"\n    }\n  },\n  {\n    \"content\": \"# Celebrating Your Couch to 5k Achievement\",\n    \"options\": {\n      \"layout\": \"cover\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?celebration\"\n    }\n  }\n]\ninput: Improve your sleep\noutput: [\n  {\n    \"content\": \"# Mastering the Art of Sleep\",\n    \"options\": {\n      \"layout\": \"cover\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?sleeping\"\n    }\n  },\n  {\n    \"content\": \"## The Importance of Sleep\\n- Rejuvenation of body and mind\\n- Boosting cognitive functions\\n- Maintaining emotional balance\",\n    \"options\": {\n      \"layout\": \"contentLeft\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?brain\"\n    }\n  },\n  {\n    \"content\": \"## Sleep Cycles & Stages\\n- REM vs. Non-REM sleep\\n- The significance of deep sleep\\n- Average sleep requirements\",\n    \"options\": {\n      \"layout\": \"contentRight\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?night-sky\"\n    }\n  },\n  {\n    \"content\": \"## 'Sleep is the golden chain that ties health and our bodies together.' \\nThomas Dekker\",\n    \"options\": {\n      \"layout\": \"cover\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?lifestyle,health\"\n    }\n  },\n  {\n    \"content\": \"## Creating a Sleep Schedule\\n- Setting a regular bedtime\\n- Importance of consistency\\n- Adjusting for weekends\",\n    \"options\": {\n      \"layout\": \"contentLeft\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?schedule, sleep\"\n    }\n  },\n  {\n    \"id\": \"1692833309577\",\n    \"content\": \"## The Sleep Environment\\n- The ideal bedroom temperature\\n- Reducing noise and light\\n- Importance of a comfortable mattress\",\n    \"options\": {\n      \"layout\": \"contentRight\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?bedroom,bed,sleep\"\n    }\n  },\n  {\n    \"id\": \"1692833309578\",\n    \"content\": \"## Food, Drink, and Sleep\\n- Foods that promote sleep\\n- The effect of caffeine and alcohol\\n- When to eat before bed\",\n    \"options\": {\n      \"layout\": \"contentLeft\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?coffee,cup\"\n    }\n  },\n  {\n    \"id\": \"1692833309579\",\n    \"content\": \"## 'Sleep is the best meditation.' -\\nDalai Lama\",\n    \"options\": {\n      \"layout\": \"cover\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?meditation\"\n    }\n  },\n  {\n    \"id\": \"1692833309580\",\n    \"content\": \"## Dealing with Sleep Disorders\\n- Recognizing signs of disorders\\n- When to see a specialist\\n- Benefits of sleep therapy\",\n    \"options\": {\n      \"layout\": \"contentRight\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?doctor,sleep\"\n    }\n  },\n  {\n    \"id\": \"1692833309581\",\n    \"content\": \"# Embrace a Future of Restful Nights\",\n    \"options\": {\n      \"layout\": \"cover\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?moon,night,sky\"\n    }\n  }\n]\ninput: Introduction to Flutter\noutput: [\n  {\n    \"id\": \"1692833420582\",\n    \"content\": \"# Flutter Framework: Unveiling Mobile App Development\",\n    \"options\": {\n      \"layout\": \"cover\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?mobile-app\"\n    }\n  },\n  {\n    \"id\": \"1692833420583\",\n    \"content\": \"## What is Flutter?\\n- Open-source UI software development toolkit\\n- Developed by Google\\n- Create applications for mobile, web, and desktop\",\n    \"options\": {\n      \"layout\": \"contentLeft\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?programmer\"\n    }\n  },\n  {\n    \"id\": \"1692833420584\",\n    \"content\": \"## Dart: The Language Behind Flutter\\n- Object-oriented programming language\\n- Developed by Google\\n- Core of Flutter's operation\",\n    \"options\": {\n      \"layout\": \"contentRight\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?programming\"\n    }\n  },\n  {\n    \"id\": \"1692833420585\",\n    \"content\": \"## 'The future of mobile is the future of online. It is how people access online content now.' \\nDavid Murphy\",\n    \"options\": {\n      \"layout\": \"cover\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?future-tech\"\n    }\n  },\n  {\n    \"id\": \"1692833420586\",\n    \"content\": \"## Flutter's Advantages\\n- Single codebase for multiple platforms\\n- Hot Reload: Instant previews\\n- Rich set of fully customizable widgets\",\n    \"options\": {\n      \"layout\": \"contentLeft\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?fast\"\n    }\n  },\n  {\n    \"id\": \"1692833420587\",\n    \"content\": \"## Setting Up Flutter\\n- Installation steps\\n- Required software and tools\\n- Creating your first Flutter app\",\n    \"options\": {\n      \"layout\": \"contentRight\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?coding\"\n    }\n  },\n  {\n    \"id\": \"1692833420588\",\n    \"content\": \"## Flutter's Widget-Based Architecture\\n- Everything is a widget\\n- Composing complex UIs from smaller pieces\\n- Stateful vs. Stateless widgets\",\n    \"options\": {\n      \"layout\": \"contentLeft\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?blueprint,mobile\"\n    }\n  },\n  {\n    \"id\": \"1692833420589\",\n    \"content\": \"## 'Any application that can be written in JavaScript, will eventually be written in JavaScript.' \\nJeff Atwood\",\n    \"options\": {\n      \"layout\": \"cover\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?javascript\"\n    }\n  },\n  {\n    \"id\": \"1692833420590\",\n    \"content\": \"## Exploring Flutter's Packages\\n- Accessing pre-made plugins and tools\\n- Importance of `pubspec.yaml`\\n- Popular Flutter packages to kickstart development\",\n    \"options\": {\n      \"layout\": \"contentRight\",\n      \"background\": \"https://source.unsplash.com/random/900×700/?packages,plugin\"\n    }\n  }\n]\ninput: $topic\noutput:",
    );
    // final response = await _palmService.generateTextWithPrompt(prompt);
    final response = await palm.generateText(
      model: PalmModel.textBison001.name,
      prompt: prompt,
      temperature: 0.7,
      maxOutputTokens: 4000,
      topP: 0.95,
      topK: 40,
      safetySettings: defaultSafetySettings,
    );

    final firstCandidate = response.candidates.first;

    if (firstCandidate == null) {
      throw Exception('Unable to generate presentation outline');
    }

    return firstCandidate.output;
  }
}
